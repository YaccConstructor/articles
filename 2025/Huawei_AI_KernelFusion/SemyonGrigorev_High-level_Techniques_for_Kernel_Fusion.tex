%15 min preso!
\documentclass[xcolor=table,aspectratio=169]{beamer}
\usepackage{beamerthemesplit}
\usepackage{wrapfig}
\usetheme{SPbGU}
\usepackage{pdfpages}
\usepackage{amsmath}
\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{indentfirst}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{multirow}
\usepackage[noend]{algpseudocode}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{fancyvrb}
\usepackage{hyperref} 
\usetikzlibrary{calc}
\usetikzlibrary{shapes,arrows}
\usetikzlibrary{arrows,automata}
\usetikzlibrary{positioning,shapes.callouts}

\usepackage{stmaryrd}
\usepackage{mathtools}
\usepackage{xparse}
\usepackage{fontawesome}

\tikzset{
    invisible/.style={opacity=0,text opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
}

\NewDocumentCommand{\mycallout}{r<> O{opacity=0.8,text opacity=1} m m}{%
\tikz[remember picture, overlay]\node[align=center, fill=cyan!20, text width=3.5cm,
#2,visible on=<#1>, rounded corners,
draw,rectangle callout,anchor=pointer,callout relative pointer={(230:1cm)}]
at (#3) {#4};
}

\usepackage{tabularx}
\newcolumntype{Y}{>{\raggedleft\arraybackslash}X}

\renewcommand{\thealgorithm}{}

\newtheorem{mytheorem}{Theorem}
\renewcommand{\thealgorithm}{}

\newcommand{\tikzmark}[1]{\tikz[overlay,remember picture] \node (#1) {};}
\def\Put(#1,#2)#3{\leavevmode\makebox(0,0){\put(#1,#2){#3}}}

\newcommand{\ltz}{$< 1$}


\tikzset{
    state/.style={
           rectangle,
           rounded corners,
           draw=black, very thick,
           minimum height=2em,
           inner sep=2pt,
           text centered,
           },
}

\beamertemplatenavigationsymbolsempty

\title[HLL for Kernel Fusion]{High-level Techniques for Kernel Fusion and Other Optimizations}
\subtitle{The AI technology in Information and Communications Technology domain sharing}
\institute[SPbSU]{
Saint Petersburg State University
}

\author[Semyon Grigorev]{Semyon Grigorev}

\date{Decamber 3, 2025}

\begin{document}
{
\begin{frame}[fragile]
  \begin{table}
  \centering
  \includegraphics[height=1.5cm]{pictures/SPbSU_logo.pdf}
  \end{table}
  \titlepage
\end{frame}
}


\begin{frame}[fragile]
  \frametitle{Problem Statement}
  \begin{itemize}
    \item[\faPlus] Library of basic functions is highly optimized
    \begin{itemize}
      \item[\faMinus] But algorithms that utilize it are not
    \end{itemize}
    \pause
    \item Intermediate data structures problem
    \tikzmark{formula_1}{}
    \begin{center}
      \[
      \underbrace{M_1 + M_2}_{M_4} + M_3 	\rightsquigarrow add(\underbrace{add(M_1,M_2)}_{\mathclap{\text{Intermediate results allocation}}}, M_3)
      \]
    \end{center}
    {
      \mycallout<2>[opacity=1]{$ (formula_1) + (1.15,-1.3)$}{Highly-optimized function from linear algebra library}
    }
    \pause
    \vspace{-0.5cm}
    \item Parametrization \\
    \tikzmark{code_1}{
    }
    %\begin{verbatim}
  \texttt{\_\_global\_\_ void $\underbrace{\texttt{handleData}}_{\mathclap{\text{Generic function}}}$ (int* filterParams, int* data, ...) \{...\}}
    %\end{verbatim}
    \vspace{0.3cm}
    \begin{center}
        {\texttt{filterParams} is static during one data processing session\\
        \vspace{0.4cm}
        How can we use this fact to optimize \texttt{handleData} procedure?}
    \end{center}
  \end{itemize}
  {
   \tikz[overlay,remember picture]{\draw[draw=red, fill opacity=0.2, line width=0.25mm] ($ (code_1) + (5.82,0.35)$) rectangle ($  (code_1) + (9.25,-0.15)$);}
   \mycallout<3>[opacity=1]{$ (code_1) + (5.9,0.25)$}{One filter for many data chunks}
   \tikz[overlay,remember picture]{\draw[draw=red, fill opacity=0.2, line width=0.25mm] ($ (code_1) + (9.6,0.35)$) rectangle ($  (code_1) + (11.6,-0.15)$);}
   \mycallout<3>[opacity=1]{$ (code_1) + (10.9,0.25)$}{Many data chunks $\Rightarrow$ many procedure runs}
  }
\end{frame}


\begin{frame}[fragile]
  \frametitle{High-Level Techniques for Code Optimization}
  \begin{itemize}
    \item Partial Evaluation\footnote{Jones, N.D., Gomard, C.K., Sestoft, P.: Partial Evaluation and Automatic Program
Generation.}
    \item Deforestation\footnote{Wadler, P.: Deforestation: Transforming Programs to Eliminate Trees.}
    \item Supercompilation\footnote{Turchin, V.F.: The Concept of a Supercompiler.}
    \item Distillation\footnote{Hamilton, G.W.: The Next 700 Program Transformers}
  \end{itemize}
  \pause
  \vfill
  \begin{itemize}
    \item[\faCheck] Can be used to solve problems described above
    \item[\faQuestion] Well-suited for functional-first programming languages
    \begin{itemize}
      \item[\faFrownO] Not for Python or C
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{High-Level Languages For High-Performance Computing (HLL for HPC)}
  
  \begin{itemize}
    \item Functional, functional-first programming languages for 
    \begin{itemize}
      \item GPGPU programming
      \item FPGA programming (program specific processors)
      \item Hardware synthesis
    \end{itemize}  
    \pause  
    \item Expressivity, high-level composable primitives 
    \item Type safety, static code checks
    \item Specific optimizations
    \begin{itemize}
      \item Fusion (stream fusion)
      \item Partial evaluation
      \item Deforestation
    \end{itemize}   
    \pause
    \item Specific hardware
  \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{HLL for HPC: Projects}

  \begin{itemize}
    \item \textbf{\href{https://anydsl.github.io/}{AnyDSL}}: A partial evaluation framework for programming high-performance libraries 
    \begin{itemize}
      \item Saarland University, German Research Center for Artificial Intelligence (DFKI)      
    \end{itemize}
    \item \textbf{\href{https://futhark-lang.org/}{Futhark}}: high-performance purely functional data-parallel array programming 
    \begin{itemize}
      \item University of Copenhagen      
    \end{itemize}
    \item \textbf{\href{https://www.lift-project.org/}{LIFT}}: high-level functional data parallel language for portable HPC 
    \begin{itemize}
      \item University of Edinburgh, University of Glasgow      
      \item Supported by HIRP FLAGSHIP
    \end{itemize}
    \item \textbf{\href{https://haflang.github.io/}{Haflang}}: special purpose processor for accelerating functional programming languages 
    \begin{itemize}
      \item Heriot Watt University
      \item Supported by Xilinx and QBayLogic
    \end{itemize}
    \item \ldots
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Kernel Fusion}
  \begin{itemize}
    
    \item[\faCheck] Stream Fusion --- for linear data
    \item[\faCheck] XLA --- for dense data
    \item[\faGears] MLIR\footnote{E.g. \href{https://mlir-graphblas.readthedocs.io/en/latest/}{mlir-graphblas}}    
    \item[\faQuestion] For general sparse computations
    \begin{itemize}
      \item Sparse attention
      \item Graph neural networks
      \item For GPGPU and other accelerators
    \end{itemize}  
  \end{itemize}
  
\end{frame}


%\begin{frame}[fragile]
%  \frametitle{Software-Hardware Platform for Functional Programming Languages}  
%  \begin{itemize}
%  \item Final goal: high-performance sparse linear algebra  
%  \item Problems 
%  \begin{itemize}
%    \item Intermediate data structures $\to$ memory traffic
%    \item Sparsity $\to$ irregular parallelism 
%  \end{itemize}
%  \end{itemize}
%\end{frame}


\begin{frame}[fragile]
  \frametitle{Distillation for Sparse Linear Algebra Kernels (Work in Progress)}  
  \begin{itemize}
  \item Distillation\footnote{\href{https://github.com/YaccConstructor/Distiller}{https://github.com/YaccConstructor/Distiller}} 
  \begin{itemize}
    \item High-level program transformation technique
    \item Includes kernel-fusion-like optimization
  \end{itemize} 
  \pause
  \item Special hardware
  \begin{itemize}
    \item Reduceron\footnote{\href{https://github.com/tommythorn/Reduceron}{https://github.com/tommythorn/Reduceron}}
    \begin{itemize}
      \item Lambda-processor
      \item Migration to Haflang
    \end{itemize}
    \item FHW\footnote{\href{https://github.com/sedwards-lab/fhw}{https://github.com/sedwards-lab/fhw}}
    \begin{itemize}
      \item Functional program to hardware translator
      \item Program-specific accelerator
    \end{itemize}
  \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Preliminary Evaluation: Input}
  \begin{itemize}
    \item A set of functions for sparse matrices manipulation  
    \begin{itemize}
      \item \verb|addMask m1 m2 m3 = mask (mtxAdd m1 m2) m3|
      \item \verb|kronMask m1 m2 m3 = mask (kron m1 m2) m3 |   
      \item \verb|addMap m1 m2 = map f (mtxAdd m1 m2)|
      \item \verb|kronMap m1 m2 = map f (kron m1 m2)|
      \item \verb|seqAdd m1 m2 m3 m4 = mtxAdd (mtxAdd (mtxAdd m1 m2) m3) m4|              
    \end{itemize}
    \item All matrices are in quad-tree format
    \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Preliminary Evaluation: Results (In Hardware Emulator)}
  
  \begin{table}
    \centering    
    \begin{tabular}{|c|c|c|c|c||c|c|c|c|}
        \hline
        \multirow{2}{*}{Function} &  \multicolumn{4}{c||}{Matrix size}  & \multicolumn{2}{c|}{Interpreter}            & Reduceron & FHW\\
        \cline{2-9}
                                  &   m1 & m2 & m3 & m4                & Steps & Reads                               & Ticks     & Ticks \\
        \hline
        seqAdd   & $64 \times 64$ & $64 \times 64$ & $64 \times 64$ & $64 \times 64$ & 2.7          & 1.9        & 1.8 & 1.4  \\ 
        addMask  & $64 \times 64$ & $64 \times 64$ & $64 \times 64$ & --             & 2.1          & 1.8        & 1.4 & 1.4  \\ 
        kronMask & $64 \times 64$ & $2 \times 2$   &$128 \times 128$& --             & 2.2          & 1.9        & 1.4 & 2.7  \\ 
        addMap   & $64 \times 64$ & $64 \times 64$ & --             & --             & 2.5          & 1.7        & 1.7 & 1.5  \\
        kronMap  & $64 \times 64$ & $2 \times 2$   & --             & --             & 2.9          & 2.2        & 1.8 & 2.0  \\ 
        \hline
        
    \end{tabular}
    \caption{Evaluation results: original program to distilled one ratio of measured metrics}
    \label{tbl:evaluationResults}
  \end{table} 
\end{frame}

 \begin{frame}[fragile] \frametitle{Big Data Processing}
    \begin{itemize}
      \item Convolution (1D, 2D, 3D) $\Rightarrow$ Data (e.g. image) processing, including AI
      \item Substring matching $\Rightarrow$ Data curving (cyber forensics)
    \end{itemize}
  \end{frame}

\begin{frame}[fragile] \frametitle{Partial Evaluation or Specialization}
   $$\llbracket \underbrace{handleData}_{handleData} \rrbracket [filterParams, data] = \llbracket \underbrace{\llbracket {\overbrace{mix}^{\mathclap{\text{partial evaluator}}}} \rrbracket [handleData,filterParams]}_{handleData_{mix}}\rrbracket [data]$$  
  \vspace{-0.3cm}  
  \begin{minipage}[t]{0.55\textwidth}
   \vspace{0.72cm}
   \tikzmark{xxx}{
   }
  \begin{verbatim}
handleData (filterParams, data)
{
  res = new List()
  for d in data
     for e in filterParams
        if d % e == 0
        then res.Add(d)
  return res
}
  \end{verbatim}
\end{minipage}
~
\begin{minipage}[t]{0.35\textwidth}
  \vspace{0.4cm}
  \underline{$\llbracket \llbracket mix \rrbracket [handleData,[2;3]]\rrbracket$}  
  \begin{verbatim}
handleData_mix (data)
{
  res = new List()
  for d in data
    if d % 2 == 0 ||
       d % 3 == 0
    then res.Add(d)
  return res
}
  \end{verbatim}
\end{minipage}
{\tikz[overlay,remember picture]{\draw[draw=red, fill opacity=0.2, line width=0.25mm] ($ (xxx) + (0.9,-2.3)$) rectangle ($  (xxx) + (13,-3.7)$);}}
\end{frame}

\begin{frame}[fragile] \frametitle{Evaluation Setup}
  \begin{itemize}
    \item We use \textbf{AnyDSL} framework for specialization
    \begin{itemize}
      \item Special DSL which can be specialized and compiled
      \item Ahead-of-time specialization
    \end{itemize}
    \item Algorithms
    \begin{itemize}
      \item Na\"{\i}ve multiple substring matching
      \item 2D convolution
    \end{itemize}
    \item Hardware
    \begin{itemize}
      \item \textbf{GTX-1070}: Pascal architecture, 8GB GDDR5, 1920 CUDA cores
      \item \textbf{Tesla T4}: Turing architecture, 16GB GDDR6, 2560 CUDA cores
    \end{itemize}

  \end{itemize}
\end{frame}


\begin{frame}[fragile] \frametitle{Evaluation: Substring Matching}
  \begin{itemize}
  \item Application: data curving
  \item Subject string: byte sequence from real hard drive
  \item Patterns: 16 file signatures from GCKâ€™s file signatures table\footnote{\url{https://www.garykessler.net/library/file_sigs.html}}
  \end{itemize}
  \begin{center}
  \begin{minipage}[t]{0.43\textwidth}
    \begin{center}
      \tikzmark{x}{\includegraphics[width=\textwidth]{pictures/Substr_1070.pdf}}
  \\Results for GTX-1070
\end{center}
\end{minipage}
\hfill
\begin{minipage}[t]{0.43\textwidth}
  \begin{center}
{\includegraphics[width=\textwidth]{pictures/Substr_T4.pdf}}
\\Results for Tesla T4
\end{center}
\end{minipage}
\end{center}
\end{frame}


\begin{frame}[fragile] \frametitle{Evaluation: 2D Convolution}
  \begin{itemize}
  \item Application: image processing
  \item Subject image: random image  of size 1GB %(16384 * 16384)
  \item Filters: random square filters with diameter 3 to 255
  \end{itemize}
  \begin{center}
  \begin{minipage}[t]{0.46\textwidth}
    \begin{center}
  \tikzmark{y}{\includegraphics[width=\textwidth]{pictures/Conv_1070.pdf}}
  \\Results for GTX-1070
\end{center}
\end{minipage}
\hfill
\begin{minipage}[t]{0.46\textwidth}
  \begin{center}
{\includegraphics[width=\textwidth]{pictures/Conv_T4.pdf}}
\\Results for Tesla T4
\end{center}
\end{minipage}
\end{center}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Conclusion}
\begin{itemize}
  \item Distillation can (partially) solve kernel fusion problem
  \item Partial evaluation can !!!
  \item Functional-first programming languages !!!
\end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Semyon Grigorev}
  \begin{minipage}{0.70\textwidth}
  \begin{itemize}    
    \item Associate professor at St. Petersburg State University
    \item Head of research group
    \item Research area
    \begin{itemize}
      \item \textbf{High-performance generic linear algebra}
      \begin{itemize}
        \item \textbf{Advanced optimization techniques} including software-hardware co-design        
        \item \textbf{GPGPU-powered} sparse linear algebra libraries
      \end{itemize}
      \item High-performance graph analysis
    \end{itemize}
    \end{itemize}
\end{minipage}
\begin{minipage}[t]{0.29\textwidth}
  \begin{center}
\includegraphics[width=0.8\textwidth]{pictures/SemyonGrigorev.jpg}
  \end{center}
  {\scriptsize
\begin{itemize}    
  \item Email: s.v.grigoriev@mail.spbu.ru
  \item GitHub: \href{https://github.com/gsvgit}{gsvgit}
  \item Google Scholar: \href{https://scholar.google.com/citations?hl=ru&user=kP4dqUAAAAAJ&view_op=list_works&sortby=pubdate}{Semyon Grigorev}
  \item DBLP: \href{https://dblp.org/pid/181/9903.html}{Semyon V. Grigorev}
\end{itemize}
  }
\end{minipage}
\end{frame}


\end{document}
